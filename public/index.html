<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <!-- 1. ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆè¨­å®šï¼ˆé‡è¦ï¼‰: ã‚¹ãƒãƒ›ã§æ–‡å­—ãŒå°ã•ããªã‚‰ãªã„ã‚ˆã†ã«å€ç‡ã‚’å›ºå®šã—ã¾ã™ -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta property="og:title" content="æ—¥é‡å…¬åœ’ãƒãƒƒãƒ—" />
    <meta
      property="og:description"
      content="æ—¥é‡å¸‚å†…ã®å…¬åœ’ã‚’åœ°å›³ä¸Šã§æ¢ã›ã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—ã§ã™ã€‚"
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://hino-park-map.web.app/" />
    <meta
      property="og:image"
      content="https://www.city.hino.lg.jp/_res/projects/default_project/_page_/001/003/232/20120702-135210.pdf"
    />
    <meta name="twitter:card" content="summary_large_image" />

    <title>æ—¥é‡å¸‚å…¬åœ’ãƒãƒƒãƒ—</title>

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />

    <!-- Leaflet.markercluster CSSï¼ˆã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"
    />

    <style>
      /* 2. ãƒãƒƒãƒ—ã‚’ç”»é¢ã„ã£ã±ã„ã«åºƒã’ã‚‹è¨­å®š */
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%; /* ç”»é¢ã®é«˜ã•ã‚’100%ä½¿ã† */
        width: 100%;
        overflow: hidden; /* ä½™è¨ˆãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’æ¶ˆã™ */
      }
      #map {
        height: 100%;
        width: 100%;
      }

      /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã‚¹ãƒãƒ›ã§è¦‹ã‚„ã™ã„ã‚ˆã†ã«èª¿æ•´ï¼‰ */
      .popup-content {
        font-family: sans-serif;
        font-size: 14px; /* æ–‡å­—ã‚µã‚¤ã‚ºã‚’å°‘ã—å¤§ãã */
        line-height: 1.5;
      }
      .popup-content h3 {
        margin: 0 0 5px;
        color: #d9534f;
        font-size: 16px;
        border-bottom: 1px solid #ccc;
        padding-bottom: 3px;
      }
      .popup-meta {
        margin-top: 8px;
        font-size: 12px;
        color: #666;
        background-color: #f9f9f9;
        padding: 4px;
        border-radius: 4px;
      }

      /* GPSãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã‚„ã™ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã«å¤‰æ›´ */
      #gps-btn {
        position: absolute;
        bottom: 20px; /* ä¸‹å´ã«é…ç½® */
        right: 10px;
        z-index: 1000;
        padding: 12px 15px; /* æŒ‡ã§æŠ¼ã—ã‚„ã™ã„ã‚µã‚¤ã‚ºã« */
        background: white;
        border: 2px solid #ccc;
        border-radius: 50px; /* ä¸¸ã¿ã‚’å¸¯ã³ã•ã›ã‚‹ */
        cursor: pointer;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* å½±ã‚’ã¤ã‘ã¦æµ®ãä¸ŠãŒã‚‰ã›ã‚‹ */
        font-size: 14px;
      }
      #gps-btn:active {
        background: #eee;
      }

      /* çµã‚Šè¾¼ã¿ãƒ‘ãƒãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      .filter-panel {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 1000; /* åœ°å›³ã‚ˆã‚Šæ‰‹å‰ã«è¡¨ç¤º */
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        max-width: 250px;
        font-family: sans-serif;
      }
      .filter-panel h3 {
        margin-top: 0;
        font-size: 16px;
      }
      .filter-item {
        margin-bottom: 5px;
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <!-- ã‚¹ãƒãƒ›ã§æŠ¼ã—ã‚„ã™ã„ä½ç½®ã«é…ç½®ã—ãŸGPSãƒœã‚¿ãƒ³ -->
    <button id="gps-btn">ğŸ“ ç¾åœ¨åœ°ã¸ç§»å‹•</button>

    <!-- çµã‚Šè¾¼ã¿ãƒ‘ãƒãƒ« -->
    <div class="filter-panel">
      <h3>è¨­å‚™ã§ã•ãŒã™</h3>
      <label class="filter-item"
        ><input type="checkbox" class="filter-chk" value="toilet" />
        ãƒˆã‚¤ãƒ¬ã‚ã‚Š</label
      >
      <label class="filter-item"
        ><input type="checkbox" class="filter-chk" value="water_play" />
        æ°´éŠã³ãŒã§ãã‚‹</label
      >
      <label class="filter-item"
        ><input type="checkbox" class="filter-chk" value="sandbox" />
        ç ‚å ´</label
      >
      <label class="filter-item"
        ><input type="checkbox" class="filter-chk" value="swing" />
        ãƒ–ãƒ©ãƒ³ã‚³</label
      >
      <label class="filter-item"
        ><input type="checkbox" class="filter-chk" value="slide" />
        ã™ã¹ã‚Šå°</label
      >
      <label class="filter-item"
        ><input type="checkbox" class="filter-chk" value="combo_play" />
        è¤‡åˆéŠå…·</label
      >
      <hr />
      <div style="font-size: 12px; color: #666">
        â€»ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã¨ã€ãã®è¨­å‚™ãŒã‚ã‚‹å…¬åœ’ã®ã¿è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
      </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <!-- Leaflet.markercluster JavaScriptï¼ˆã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ï¼‰ -->
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <script>
      // --- 1. åœ°å›³ã®åˆæœŸåŒ– ---
      // ã‚¹ãƒãƒ›ã§ã®èª¤æ“ä½œã‚’é˜²ããŸã‚ã€ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ä½ç½®ã‚’èª¿æ•´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™
      const map = L.map('map', {
        zoomControl: false, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚ºãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’ä¸€æ—¦éè¡¨ç¤ºï¼ˆæŒ‡ã§ãƒ”ãƒ³ãƒæ“ä½œã™ã‚‹ãŸã‚ï¼‰
      }).setView([35.665, 139.4], 13);

      // ã‚ºãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’å³ä¸‹ã«å†é…ç½®ï¼ˆãŠå¥½ã¿ã§ï¼‰
      L.control.zoom({ position: 'bottomright' }).addTo(map);

      // --- 2. åœ°å›³ã‚¿ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ ---
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution:
          '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      }).addTo(map);

      // æœ¨ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’å®šç¾©
      const parkIcon = L.icon({
        iconUrl: './img/tree.svg', // ä¿å­˜ã—ãŸSVGãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
        iconSize: [32, 32], // â˜…ã‚µã‚¤ã‚ºã‚’[å¹…, é«˜ã•]ã§æŒ‡å®šï¼ˆä¾‹: 32pxï¼‰
        iconAnchor: [16, 32], // â˜…ã‚¢ã‚¤ã‚³ãƒ³ã®åº•è¾ºä¸­å¤®ã‚’åº§æ¨™ã«åˆã‚ã›ã‚‹ [å¹…/2, é«˜ã•]
        popupAnchor: [0, -32], // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒã‚¢ã‚¤ã‚³ãƒ³ã®ã™ãä¸Šã«å‡ºã‚‹ã‚ˆã†ã«èª¿æ•´
      });

      let geojsonLayer; // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ“ä½œã™ã‚‹ãŸã‚ã®å¤‰æ•°
      let allData = null; // èª­ã¿è¾¼ã‚“ã å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹å¤‰æ•°

      // 3. GeoJSONãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã¨ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°
      fetch('parks.geojson')
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          allData = data;
          updateMap();
        })
        .catch(function (error) {
          console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        });

      // --- 4. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å¤‰æ›´æ™‚ã«åœ°å›³ã‚’æ›´æ–°ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
      document.querySelectorAll('.filter-chk').forEach(function (input) {
        input.addEventListener('change', updateMap);
      });

      // --- 5. GPSæ©Ÿèƒ½ ---
      document.getElementById('gps-btn').addEventListener('click', function () {
        if (!navigator.geolocation) {
          alert('ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚');
          return;
        }
        // ä½ç½®å–å¾—ä¸­ã¯ãƒœã‚¿ãƒ³ã®æ–‡å­—ã‚’å¤‰ãˆã‚‹ãªã©ã®å·¥å¤«ã‚‚å¯èƒ½
        navigator.geolocation.getCurrentPosition(
          function (position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;

            // ç¾åœ¨åœ°ã¸ã‚ºãƒ¼ãƒ 
            map.setView([lat, lng], 16);

            // ç¾åœ¨åœ°ãƒãƒ¼ã‚«ãƒ¼ï¼ˆå††å½¢ï¼‰
            L.circleMarker([lat, lng], {
              color: 'blue',
              fillColor: '#30f',
              fillOpacity: 0.5,
              radius: 8,
            })
              .addTo(map)
              .bindPopup('ç¾åœ¨åœ°')
              .openPopup();
          },
          function (error) {
            alert(
              'ä½ç½®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ç«¯æœ«ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
            );
          },
        );
      });

      // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨å†æç”»
      function updateMap() {
        // ã‚‚ã—æ—¢ã«ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚ã‚Œã°å‰Šé™¤ï¼ˆã‚¯ãƒªã‚¢ï¼‰
        if (geojsonLayer) {
          map.removeLayer(geojsonLayer);
        }

        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’å–å¾—
        let filters = {};
        document.querySelectorAll('.filter-chk').forEach(function (input) {
          if (input.checked) {
            filters[input.value] = true;
          }
        });

        // (A) ã‚¯ãƒ©ã‚¹ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆï¼ˆã“ã®ä¸­ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’å…¥ã‚Œã¾ã™ï¼‰
        const markers = L.markerClusterGroup();

        // (B) GeoJSONãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆï¼ˆã¾ã åœ°å›³ã«ã¯è¿½åŠ ã—ãªã„ï¼‰
        const geoJsonLayer = L.geoJSON(allData, {
          pointToLayer: function (feature, latlng) {
            // feature.properties.name ã¯ GeoJSON ã® "name" ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆå…¬åœ’åã‚„æ–‡åŒ–è²¡åï¼‰
            return L.marker(latlng, {
              icon: parkIcon, // ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¨­å®š
              title: feature.properties.name, // ãƒã‚¦ã‚¹ãƒ›ãƒãƒ¼æ™‚ã«åç§°ãŒè¡¨ç¤ºã•ã‚Œã‚‹
              alt: feature.properties.name, // ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼èª­ã¿ä¸Šã’ç”¨ï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œï¼‰
            });
          },
          onEachFeature: function (feature, layer) {
            if (feature.properties) {
              const popupHTML = `
                  <div class="popup-content" style="max-width:250px;">
                    <h3>${feature.properties.name}</h3>
                    <p>${feature.properties.desc}</p>
                    <div class="popup-meta">ä½æ‰€: ${feature.properties.address}</div>
                  </div>
                `;

              layer.bindPopup(popupHTML);
            }
          },
          filter: function (feature) {
            // å…¨ã¦ã®ãƒã‚§ãƒƒã‚¯é …ç›®ã«ã¤ã„ã¦ã€ãƒ‡ãƒ¼ã‚¿å´ãŒ true ã‹ç¢ºèª
            for (var key in filters) {
              // ãƒ‡ãƒ¼ã‚¿ã«ãã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒç„¡ã„ã€ã¾ãŸã¯ false ã®å ´åˆã¯éè¡¨ç¤º
              if (!feature.properties[key]) {
                return false;
              }
            }
            return true; // å…¨æ¡ä»¶ã‚¯ãƒªã‚¢ãªã‚‰è¡¨ç¤º
          },
        });

        // (C) ä½œæˆã—ãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚¯ãƒ©ã‚¹ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ 
        markers.addLayer(geoJsonLayer);

        // (D) æœ€å¾Œã«ã‚¯ãƒ©ã‚¹ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã‚’åœ°å›³ã«è¿½åŠ 
        map.addLayer(markers);
      }
    </script>
  </body>
</html>
